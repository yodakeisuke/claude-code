---
# =====================================================
# AoT Loop State File Template (v1.3)
# =====================================================
# This file is generated by /align-goal and managed by
# the AoT Loop system. Do not edit manually unless you
# know what you're doing.
#
# File location: .claude/aot-loop-state.md
#
# v1.3 Changes:
#   - Checklist format for base_case
#   - Negative conditions (not_command, not_file)
#   - Quality type (LLM as a Judge + Rubric)
# =====================================================

# === Objective (Goal Alignment) ===
objective:
  # Minimal summary of the goal
  goal: ""

  # Completion criteria
  # Format 1: Legacy (type + value)
  # base_case:
  #   type: command        # command | file | assertion
  #   value: ""            # Shell command, file path, or condition

  # Format 2: Checklist (v1.3+ recommended)
  base_case:
    checklist:
      - item: "Functional Requirements"
        group:
          - item: "Tests pass"
            check:
              type: command
              value: "npm test"
          - item: "Build succeeds"
            check:
              type: command
              value: "npm run build"

      - item: "Quality Requirements"
        group:
          - item: "No lint errors"
            check:
              type: command
              value: "npm run lint"
          - item: "No vulnerabilities"
            check:
              type: not_command           # Negative: PASS if exit code â‰  0
              value: "npm audit --audit-level=high"

      - item: "Code Quality"
        check:
          type: quality                   # LLM as a Judge
          criteria: "Code is readable and well designed"
          pass_threshold: 3               # 1-5 scale, >= 3 is PASS
          # Or use rubric format:
          # rubric:
          #   - criterion: "Readability"
          #     weight: 0.5
          #     levels:
          #       1: "Hard to read"
          #       3: "Mostly readable"
          #       5: "Very readable"
          # pass_threshold: 3.5

  # Why this work is needed
  background_intent: ""

  # What will be produced
  deliverables: ""

  # Human-readable completion criteria
  definition_of_done: ""

  # Execution constraints
  constraints:
    max_iterations: 20       # Maximum loop iterations
    max_parallel_agents: 3   # Maximum concurrent workers
    max_stall_count: 3       # Stalls before stopping

# === Execution Control ===
control:
  status: pending            # pending | running | stopped | completed
  iteration: 0               # Current iteration count
  stall_count: 0             # Consecutive stall count
  prev_pending_count: -1     # Previous unresolved count (-1 = first iteration)
  stop_requested: false      # Manual stop flag
  stop_reason: null          # Reason for stopping (if any)
  redirect_requested: false  # Redirect in progress flag

# === Work Graph (Atoms) ===
# Each Atom represents a task unit
atoms:
  - id: A1                   # Unique ID (A1, A2, ...)
    description: ""          # What needs to be done
    status: pending          # pending | in_progress | resolved
    depends_on: []           # IDs of Atoms this depends on
    # or_group: null         # Optional: OR group membership

# === Decompositions ===
# Track how Atoms are broken down
decompositions: []
# Example:
#   - parent: A2
#     children: [A3, A4]
#     reason: "Split into subtasks"

# === OR Groups ===
# Define alternative approaches (with automatic backtracking)
or_groups: {}
# Example:
#   auth_method:
#     choices: [A4_jwt, A4_session]
#     selected: A4_jwt
#     failed: []           # Auto-populated on failure

# === Bindings ===
# Results from resolved Atoms
bindings: {}
# Example:
#   A1:
#     summary: "Created User model"
#     artifacts: ["src/models/user.ts"]

# === Trail ===
# OR branch selection history
trail: []
# Example:
#   - or_group: auth_method
#     selected: A4_jwt
#     reason: "Stateless preferred"
#     timestamp: "2025-01-15T10:00:00Z"

# === Corrections ===
# Redirect history
corrections: []
# Example:
#   - timestamp: "2025-01-15T10:30:00Z"
#     type: dag_adjustment
#     description: "Added caching requirement"
#     trail_cleared: false
---

# Original Prompt

(The user's original request will be recorded here)
